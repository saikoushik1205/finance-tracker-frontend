<app-navbar></app-navbar>

<div class="other-container">
  <div class="page-header fade-in">
    <div>
      <h1>ğŸ’¼ Cash & Bank</h1>
      <p class="text-muted">Manage your cash and bank balances</p>
      @if (lastUpdated) {
      <p class="last-updated">Last updated: {{ formatDate(lastUpdated) }}</p>
      }
    </div>
  </div>

  @if (loading) {
  <div class="loading-state glass-card">
    <div class="spinner"></div>
    <p class="text-muted">Loading balances...</p>
  </div>
  } @else {
  <!-- Total Balance Summary -->
  <div class="total-summary glass-card fade-in">
    <div class="summary-content">
      <p class="summary-label">Total Balance</p>
      <p class="summary-amount">{{ formatCurrency(getTotalBalance()) }}</p>
      <div class="balance-breakdown">
        <div class="breakdown-item">
          <span class="breakdown-label">ğŸ’µ Cash</span>
          <span class="breakdown-value"
            >{{ getCashPercentage().toFixed(1) }}%</span
          >
        </div>
        <div class="breakdown-item">
          <span class="breakdown-label">ğŸ¦ Bank</span>
          <span class="breakdown-value"
            >{{ getBankPercentage().toFixed(1) }}%</span
          >
        </div>
      </div>
    </div>
    <div class="balance-chart">
      <svg viewBox="0 0 200 200" class="pie-chart">
        <circle
          cx="100"
          cy="100"
          r="80"
          fill="none"
          stroke="#4299e1"
          stroke-width="40"
          [attr.stroke-dasharray]="getBankPercentage() * 5.027 + ' 502.7'"
          transform="rotate(-90 100 100)"
        />
        <circle
          cx="100"
          cy="100"
          r="80"
          fill="none"
          stroke="#48bb78"
          stroke-width="40"
          [attr.stroke-dasharray]="getCashPercentage() * 5.027 + ' 502.7'"
          [attr.stroke-dashoffset]="-getBankPercentage() * 5.027"
          transform="rotate(-90 100 100)"
        />
      </svg>
    </div>
  </div>

  <!-- Balance Cards Grid -->
  <div class="balances-grid">
    <!-- Cash Balance Card -->
    <div class="balance-card glass-card slide-in">
      <div class="card-header">
        <div class="card-icon cash">ğŸ’µ</div>
        <div class="card-title">
          <h2>Cash Balance</h2>
          <p class="card-subtitle">Physical cash in hand</p>
        </div>
      </div>

      <div class="card-body">
        @if (!editingCash) {
        <div class="balance-display">
          <p class="balance-amount cash-color">
            {{ formatCurrency(cashBalance) }}
          </p>
          <p class="balance-percentage">
            {{ getCashPercentage().toFixed(1) }}% of total
          </p>
        </div>
        <button class="btn btn-primary btn-block" (click)="startEditCash()">
          âœï¸ Update Cash
        </button>
        } @else {
        <div class="balance-edit">
          <div class="form-group">
            <label for="cashInput">Enter Amount (â‚¹)</label>
            <input
              type="number"
              id="cashInput"
              class="form-control"
              [(ngModel)]="tempCash"
              min="0"
              step="0.01"
              placeholder="0.00"
              [disabled]="saving"
            />
          </div>
          <div class="edit-actions">
            <button
              class="btn btn-secondary"
              (click)="cancelEditCash()"
              [disabled]="saving"
            >
              Cancel
            </button>
            <button
              class="btn btn-primary"
              (click)="saveCash()"
              [disabled]="saving"
            >
              @if (saving) {
              <span class="btn-spinner"></span>
              } Save
            </button>
          </div>
        </div>
        }
      </div>

      <div class="card-footer">
        <div class="progress-bar">
          <div
            class="progress-fill cash"
            [style.width.%]="getCashPercentage()"
          ></div>
        </div>
      </div>
    </div>

    <!-- Bank Balance Card -->
    <div class="balance-card glass-card slide-in" style="animation-delay: 0.1s">
      <div class="card-header">
        <div class="card-icon bank">ğŸ¦</div>
        <div class="card-title">
          <h2>Bank Balance</h2>
          <p class="card-subtitle">Money in bank accounts</p>
        </div>
      </div>

      <div class="card-body">
        @if (!editingBank) {
        <div class="balance-display">
          <p class="balance-amount bank-color">
            {{ formatCurrency(bankBalance) }}
          </p>
          <p class="balance-percentage">
            {{ getBankPercentage().toFixed(1) }}% of total
          </p>
        </div>
        <button class="btn btn-primary btn-block" (click)="startEditBank()">
          âœï¸ Update Bank
        </button>
        } @else {
        <div class="balance-edit">
          <div class="form-group">
            <label for="bankInput">Enter Amount (â‚¹)</label>
            <input
              type="number"
              id="bankInput"
              class="form-control"
              [(ngModel)]="tempBank"
              min="0"
              step="0.01"
              placeholder="0.00"
              [disabled]="saving"
            />
          </div>
          <div class="edit-actions">
            <button
              class="btn btn-secondary"
              (click)="cancelEditBank()"
              [disabled]="saving"
            >
              Cancel
            </button>
            <button
              class="btn btn-primary"
              (click)="saveBank()"
              [disabled]="saving"
            >
              @if (saving) {
              <span class="btn-spinner"></span>
              } Save
            </button>
          </div>
        </div>
        }
      </div>

      <div class="card-footer">
        <div class="progress-bar">
          <div
            class="progress-fill bank"
            [style.width.%]="getBankPercentage()"
          ></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Stats -->
  <div class="quick-stats glass-card fade-in">
    <h3>ğŸ’¡ Quick Insights</h3>
    <div class="stats-grid">
      <div class="stat-box">
        <div class="stat-icon">ğŸ’µ</div>
        <div class="stat-content">
          <p class="stat-label">Cash Available</p>
          <p class="stat-value">{{ formatCurrency(cashBalance) }}</p>
        </div>
      </div>
      <div class="stat-box">
        <div class="stat-icon">ğŸ¦</div>
        <div class="stat-content">
          <p class="stat-label">Bank Balance</p>
          <p class="stat-value">{{ formatCurrency(bankBalance) }}</p>
        </div>
      </div>
      <div class="stat-box">
        <div class="stat-icon">ğŸ’°</div>
        <div class="stat-content">
          <p class="stat-label">Total Assets</p>
          <p class="stat-value">{{ formatCurrency(getTotalBalance()) }}</p>
        </div>
      </div>
      <div class="stat-box">
        <div class="stat-icon">
          @if (getCashPercentage() > getBankPercentage()) { ğŸ“Š } @else { ğŸ¦ }
        </div>
        <div class="stat-content">
          <p class="stat-label">Dominant</p>
          <p class="stat-value">
            @if (getCashPercentage() > getBankPercentage()) { Cash ({{
              getCashPercentage().toFixed(0)
            }}%) } @else { Bank ({{ getBankPercentage().toFixed(0) }}%) }
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Tips Section -->
  <div class="tips-section glass-card fade-in">
    <h3>ğŸ’¡ Financial Tips</h3>
    <div class="tips-list">
      <div class="tip-item">
        <span class="tip-icon">âœ…</span>
        <p>Keep emergency cash for unexpected expenses</p>
      </div>
      <div class="tip-item">
        <span class="tip-icon">ğŸ¦</span>
        <p>Maintain 60-70% of funds in bank for security</p>
      </div>
      <div class="tip-item">
        <span class="tip-icon">ğŸ“Š</span>
        <p>Review and update balances regularly</p>
      </div>
      <div class="tip-item">
        <span class="tip-icon">ğŸ’°</span>
        <p>Track all cash withdrawals and deposits</p>
      </div>
    </div>
  </div>
  }
</div>
